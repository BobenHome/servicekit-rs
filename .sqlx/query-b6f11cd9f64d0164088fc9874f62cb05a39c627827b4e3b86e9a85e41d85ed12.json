{
  "db_name": "MySQL",
  "query": "-- name: refresh_mc_org_show\n-- 刷新mc_org_show\nINSERT INTO mc_org_show(ID,\n                        IS_CORP,\n                        NO,\n                        NAME,\n                        ABBREVIATION,\n                        REMARK,\n                        TYPE,\n                        DISTRICT,\n                        COMPANY_NATURE,\n                        COMPANY_TYPE,\n                        COMPANY_ID,\n                        ORG_TYPE,\n                        DEPT_LEVEL,\n                        DEPT_TYPE,\n                        LEGAL,\n                        TAXPAYER_NUMBER,\n                        WEBSITE,\n                        BUSINESS_ADDRESS,\n                        BUSINESS_CAPITAL,\n                        AREA,\n                        A_CODE,\n                        PROVINCE,\n                        P_CODE,\n                        CITY,\n                        C_CODE,\n                        CTCPROVINCE,\n                        CTCAREA,\n                        CTCCITY,\n                        LEAF,\n                        OLEVEL,\n                        PARENT,\n                        WEIGHT,\n                        ANCESTORS,\n                        GLOBLE,\n                        IS_DELETE,\n                        YEAR,\n                        MONTH,\n                        MSSID,\n                        MSSIDENTITY,\n                        MSSCODE,\n                        MSSHRCODE,\n                        MSSNAME,\n                        MSSTYPE,\n                        MSSPARENTCOMPANYCODE,\n                        MSSPARENTDEPARTMENTCODE,\n                        MSSSTATUS,\n                        MSSCHIEFLEADER,\n                        MSSDEPUTYLEADER,\n                        MSSCOMPANYTYPE,\n                        MSSDEPARTMENTTYPE,\n                        MSSDEPARTMENTLEVEL,\n                        CODE_3,\n                        CODE_4,\n                        CODE_5,\n                        CODE_6,\n                        CODE_7,\n                        CODE_8,\n                        CODE_9,\n                        DIRECTLY_NUM,\n                        ATTACHED_NUM,\n                        COMPANY_NAME,\n                        COMPANY_GLOBLE,\n                        COMPANY_GLOBLE_NAME,\n                        GLOBLE_NAME,\n                        LOG_SDATE)\nSELECT TE.ID,\n       TE.IS_CORP,\n       TE.NO,\n       TE.NAME,\n       TE.ABBREVIATION,\n       TE.REMARK,\n       TE.TYPE,\n       ''                                                                                   AS DISTRICT,\n       ''                                                                                   AS COMPANY_NATURE,\n       TE.COMPANY_TYPE,\n       TE.COMPANY_ID,\n       TE.ORG_TYPE,\n       TE.DEPT_LEVEL,\n       TE.DEPT_TYPE,\n       TE.LEGAL,\n       TE.TAXPAYER_NUMBER,\n       TE.WEBSITE,\n       TE.BUSINESS_ADDRESS,\n       TE.BUSINESS_CAPITAL,\n       ''                                                                                   AS AREA,\n       ''                                                                                   AS A_CODE,\n       TE.PROVINCE,\n       TE.P_CODE,\n       TE.CITY                                                                              AS CITY,\n       TE.C_CODE                                                                            AS C_CODE,\n       ''                                                                                   AS CTCPROVINCE,\n       ''                                                                                   AS CTCAREA,\n       ''                                                                                   AS CTCCITY,\n       TR.LEAF                                                                              AS LEAF,\n       TRUNCATE((LENGTH(tr.ancestors) - LENGTH(REPLACE(tr.ancestors, '，', ''))) / 3, 0) + 2 AS OLEVEL,\n       TR.PARENT                                                                            AS PARENT,\n       TE.WEIGHT                                                                            AS WEIGHT,\n       TR.ANCESTORS                                                                         AS ANCESTORS,\n       TE.FULL_PATH_ID                                                                      AS GLOBLE,\n       TE.IS_DELETE                                                                         AS IS_DELETE,\n       TE.YEAR AS YEAR,\n                       TE.MONTH                                                                             AS MONTH,\n                       MO.ID                                                                                AS MSSID,\n                       MO.IDENTITY                                                                          AS MSSIDENTITY,\n                       MO.CODE                                                                              AS MSSCODE,\n                       MO.HRCODE                                                                            AS MSSHRCODE,\n                       MO.NAME                                                                              AS MSSNAME,\n                       MO.TYPE                                                                              AS MSSTYPE,\n                       MO.PARENTCOMPANYCODE                                                                 AS MSSPARENTCOMPANYCODE,\n                       MO.PARENTDEPARTMENTCODE                                                              AS MSSPARENTDEPARTMENTCODE,\n                       MO.STATUS                                                                            AS MSSSTATUS,\n                       ''                                                                                   AS MSSCHIEFLEADER,\n                       ''                                                                                   AS MSSDEPUTYLEADER,\n                       MO.COMPANYTYPE                                                                       AS MSSCOMPANYTYPE,\n                       ''                                                                                   AS MSSDEPARTMENTTYPE,\n                       ''                                                                                   AS MSSDEPARTMENTLEVEL,\n                       IF((LENGTH(TR.FULL_PATH_ID) - LENGTH(REPLACE(TR.FULL_PATH_ID, ',', ''))) / LENGTH(',') >= 2,\n                          SUBSTRING_INDEX(SUBSTRING_INDEX(TR.FULL_PATH_ID, ',', 3), ',', -1), NULL)         AS CODE_3,\n                       IF((LENGTH(TR.FULL_PATH_ID) - LENGTH(REPLACE(TR.FULL_PATH_ID, ',', ''))) / LENGTH(',') >= 3,\n                          SUBSTRING_INDEX(SUBSTRING_INDEX(TR.FULL_PATH_ID, ',', 4), ',', -1), NULL)         AS CODE_4,\n                       IF((LENGTH(TR.FULL_PATH_ID) - LENGTH(REPLACE(TR.FULL_PATH_ID, ',', ''))) / LENGTH(',') >= 4,\n                          SUBSTRING_INDEX(SUBSTRING_INDEX(TR.FULL_PATH_ID, ',', 5), ',', -1), NULL)         AS CODE_5,\n                       IF((LENGTH(TR.FULL_PATH_ID) - LENGTH(REPLACE(TR.FULL_PATH_ID, ',', ''))) / LENGTH(',') >= 5,\n                          SUBSTRING_INDEX(SUBSTRING_INDEX(TR.FULL_PATH_ID, ',', 6), ',', -1), NULL)         AS CODE_6,\n                       IF((LENGTH(TR.FULL_PATH_ID) - LENGTH(REPLACE(TR.FULL_PATH_ID, ',', ''))) / LENGTH(',') >= 6,\n                          SUBSTRING_INDEX(SUBSTRING_INDEX(TR.FULL_PATH_ID, ',', 7), ',', -1), NULL)         AS CODE_7,\n                       IF((LENGTH(TR.FULL_PATH_ID) - LENGTH(REPLACE(TR.FULL_PATH_ID, ',', ''))) / LENGTH(',') >= 7,\n                          SUBSTRING_INDEX(SUBSTRING_INDEX(TR.FULL_PATH_ID, ',', 8), ',', -1), NULL)         AS CODE_8,\n                       IF((LENGTH(TR.FULL_PATH_ID) - LENGTH(REPLACE(TR.FULL_PATH_ID, ',', ''))) / LENGTH(',') >= 8,\n                          SUBSTRING_INDEX(SUBSTRING_INDEX(TR.FULL_PATH_ID, ',', 9), '，', -1), NULL)         AS CODE_9,\n                       (SELECT COUNT(U.ID) FROM mc_user_ztk U WHERE U.ORG = TE.ID)                          AS DIRECTLY_NUM,\n                       0                                                                                    AS ATTACHED_NUM,\n                       TR.NAME                                                                              AS COMPANY_NAME,\n                       TR.FULL_PATH_ID                                                                      AS COMPANY_GLOBLE,\n                       TR.FULL_PATH_NAME                                                                    AS COMPANY_GLOBLE_NAME,\n                       TE.FULL_PATH_NAME                                                                    AS GLOBLE_NAME,\n                       DATE_FORMAT(NOW(), '%Y-%m-%d')                                                       AS LOG_SDATE\nFROM d_telecom_org TE\n    LEFT JOIN d_telecom_org_tree TR\nON TE.ID = TR.ID\n    LEFT JOIN d_mss_org_mapping MOM\n    ON TE.ID = MOM.CODE\n    LEFT JOIN d_mss_org MO\n    ON MOM.MSSCODE = MO.HRCODE AND MO.STATUS = '1'",
  "describe": {
    "columns": [],
    "parameters": {
      "Right": 0
    },
    "nullable": []
  },
  "hash": "b6f11cd9f64d0164088fc9874f62cb05a39c627827b4e3b86e9a85e41d85ed12"
}
